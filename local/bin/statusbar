#!/bin/sh
xsetroot -name " $(cat /sys/class/power_supply/BAT0/capacity)% | $current_time | Getting weather. . . "
timer=600
while true
do
	music="$(mpc --format "%artist% - %title%" current)"
	power="$(cat /sys/class/power_supply/BAT0/capacity)%"
	volume="$(amixer get Master | awk '$0~/%/{print $4}' | tr -d '[]')"
	muted="$(amixer get Master | awk '$0~/%/{print $6}' | tr -d '[]')"
	if [ $(cat /sys/class/power_supply/BAT0/status) != "Discharging" ]; then
		power="ðŸ—² $power"
	fi
	if [ $timer -eq 600 ]; then
		let timer=0;
		wget -q --spider http://wttr.in
		if [ $? -eq 0 ]; then
			weather=$(curl "wttr.in/Fort Collins?format=3&u");
		else
			weather="Weather unavailable"
		fi
	fi

	if [ $muted != 'off' ];
	then
		volume="$volume (M)"
	fi
	current_time=$(date "+%Y %b %d %H:%M")
	xsetroot -name " $music | $power | vol: $volume | $current_time | $weather"
	let timer=$timer+1
	sleep 1
done

